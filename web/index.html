<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Text Predictor</title>
<style>
    :root {
        --primary: #4f46e5;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --groq: #8b5cf6;
        --light-bg: #f8fafc;
        --border: #e5e7eb;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1100px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        overflow: hidden;
    }

    header {
        background: linear-gradient(to right, var(--primary), var(--groq));
        color: white;
        padding: 25px 30px;
    }

    h1 { font-size: 2.2rem; margin-bottom: 8px; }
    .subtitle { opacity: 0.9; font-size: 1rem; margin-bottom: 10px; }

    .model-badge {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 14px;
        font-weight: 600;
        margin-left: 10px;
    }

    .main-content { padding: 30px; }
    .input-section { margin-bottom: 30px; }

    textarea {
        width: 100%;
        min-height: 140px;
        padding: 18px;
        border: 2px solid var(--border);
        border-radius: 12px;
        font-size: 18px;
        resize: vertical;
        transition: all 0.3s;
        font-family: inherit;
        line-height: 1.5;
    }

    textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .input-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 10px;
    }

    .btn {
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .btn-secondary { background: #f3f4f6; color: #374151; }
    .btn-secondary:hover { background: #e5e7eb; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-danger:hover { background: #dc2626; }

    .key-hint {
        color: #6b7280;
        font-size: 13px;
        margin-top: 5px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .controls {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
        align-items: center;
    }

    .model-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #f3f4f6;
        padding: 8px 12px;
        border-radius: 20px;
    }

    .toggle-switch {
        position: relative;
        width: 60px;
        height: 30px;
    }

    .toggle-switch input { opacity: 0; width: 0; height: 0; }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0; left: 0; right: 0; bottom: 0;
        background: var(--success);
        transition: .4s;
        border-radius: 34px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .toggle-slider { background: var(--groq); }
    input:checked + .toggle-slider:before { transform: translateX(30px); }

    select, .checkbox-group {
        padding: 10px 16px;
        border: 2px solid var(--border);
        border-radius: 8px;
        font-size: 15px;
        background: white;
        cursor: pointer;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
        user-select: none;
    }

    .status-bar {
        background: var(--light-bg);
        padding: 15px 20px;
        border-radius: 10px;
        margin: 20px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .language-badge, .accuracy-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: 500;
        color: white;
    }

    .language-badge { background: var(--primary); }
    .accuracy-badge { background: var(--success); }

    .correction-msg {
        background: #fef3c7;
        border-left: 4px solid var(--warning);
        padding: 10px 15px;
        border-radius: 6px;
        margin: 10px 0;
        font-size: 14px;
        display: none;
    }

    .predictions-section { margin-bottom: 30px; }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .predictions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 12px;
    }

    .prediction-item {
        background: var(--light-bg);
        border: 2px solid var(--border);
        border-radius: 10px;
        padding: 12px 16px;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
        position: relative;
    }

    .prediction-item:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    .confidence-badge {
        position: absolute;
        top: 6px;
        right: 6px;
        background: #e5e7eb;
        color: #6b7280;
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 10px;
    }

    .prediction-item:hover .confidence-badge {
        background: rgba(255, 255, 255, 0.3);
        color: white;
    }

    .correction-suggestions {
        margin-top: 10px;
        padding: 10px;
        background: #f0f9ff;
        border: 2px solid #bae6fd;
        border-radius: 8px;
        display: none;
    }

    .correction-suggestion {
        display: inline-block;
        background: white;
        padding: 6px 12px;
        margin: 4px;
        border-radius: 6px;
        cursor: pointer;
        border: 1px solid #bae6fd;
        transition: all 0.2s;
    }

    .correction-suggestion:hover {
        background: var(--success);
        color: white;
        border-color: var(--success);
    }

    .sentence-item {
        background: #f0f9ff;
        border: 2px solid #bae6fd;
        border-radius: 10px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 15px;
        line-height: 1.5;
    }

    .sentence-item:hover {
        background: #e0f2fe;
        transform: translateY(-2px);
    }

    .loading {
        text-align: center;
        padding: 20px;
        color: #6b7280;
        grid-column: 1 / -1;
    }

    .speech-status {
        margin-top: 10px;
        padding: 10px;
        border-radius: 8px;
        display: none;
        font-size: 14px;
    }

    @media (max-width: 768px) {
        .container { margin: 0; border-radius: 12px; }
        header, .main-content { padding: 20px 15px; }
        h1 { font-size: 1.6rem; }
        textarea { min-height: 120px; padding: 15px; }
        .predictions-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
    }
</style>
</head>
<body>
<div class="container">
    <header>
        <h1>Smart Text Predictor</h1>
        <div class="subtitle">
            Multi-language next word prediction 
            <span id="modelBadge" class="model-badge">N-gram</span>
        </div>
    </header>
    
    <div class="main-content">
        <div class="input-section">
            <textarea id="inputText" placeholder="Start typing here... or click the microphone to speak" autofocus></textarea>
            
            <div class="input-actions">
                <button class="btn btn-secondary" onclick="predictor.toggleVoiceInput()" id="voiceBtn" title="Voice Input">
                    ðŸŽ¤ Voice
                </button>
                <button class="btn btn-danger" onclick="predictor.clearText()" title="Clear Text">
                    âœ• Clear
                </button>
            </div>
            
            <div class="key-hint">
                <span>ðŸ’¡ Tip: Press Space to auto-correct last word | Click predictions to insert</span>
            </div>
            
            <div class="correction-msg" id="correctionMessage"></div>
            <div id="correctionSuggestions" class="correction-suggestions"></div>
            <div id="speechStatus" class="speech-status"></div>
        </div>
        
        <div class="controls">
            <div class="model-toggle">
                <span>N-gram</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="modelToggle">
                    <span class="toggle-slider"></span>
                </label>
                <span>Groq AI</span>
            </div>
            
            <select id="languageSelect">
                <option value="auto">Auto Detect</option>
                <option value="en">English</option>
                <option value="hi">Hindi</option>
                <option value="te">Telugu</option>
                <option value="ta">Tamil</option>
                <option value="kn">Kannada</option>
                <option value="fr">French</option>
            </select>
            
            <div class="checkbox-group">
                <input type="checkbox" id="autoCorrect" checked>
                <label for="autoCorrect">Auto-correct</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="autoPredict" checked>
                <label for="autoPredict">Auto-predict</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="includeSentences" checked>
                <label for="includeSentences">Show sentences</label>
            </div>
        </div>
        
        <div class="status-bar">
            <div>Status: <span id="status">Ready</span></div>
            <div>Language: <span id="detectedLang" class="language-badge">-</span></div>
            <div>Accuracy: <span id="accuracyScore" class="accuracy-badge">--%</span></div>
            <div>Time: <span id="responseTime">-</span>ms</div>
        </div>
        
        <div class="predictions-section">
            <div class="section-header">
                <h3>Next Word Predictions:</h3>
            </div>
            <div id="predictionsContainer" class="predictions-grid">
                <div class="loading">Start typing to see predictions...</div>
            </div>
        </div>
        
        <div class="predictions-section" id="sentenceSection">
            <div class="section-header">
                <h3>Sentence Completions:</h3>
            </div>
            <div id="sentenceContainer" class="predictions-grid">
                <div class="loading">Sentence predictions will appear here...</div>
            </div>
        </div>
    </div>
</div>

<script>
class TextPredictor {
    constructor() {
        this.input = document.getElementById('inputText');
        this.predictionsContainer = document.getElementById('predictionsContainer');
        this.sentenceContainer = document.getElementById('sentenceContainer');
        this.status = document.getElementById('status');
        this.detectedLang = document.getElementById('detectedLang');
        this.responseTime = document.getElementById('responseTime');
        this.accuracyScore = document.getElementById('accuracyScore');
        this.correctionMessage = document.getElementById('correctionMessage');
        this.correctionSuggestions = document.getElementById('correctionSuggestions');
        this.speechStatus = document.getElementById('speechStatus');
        this.modelBadge = document.getElementById('modelBadge');
        this.voiceBtn = document.getElementById('voiceBtn');
        this.languageSelect = document.getElementById('languageSelect');
        this.autoCorrect = document.getElementById('autoCorrect');
        this.autoPredict = document.getElementById('autoPredict');
        this.includeSentences = document.getElementById('includeSentences');
        this.modelToggle = document.getElementById('modelToggle');
        
        this.debounceTimer = null;
        this.lastInput = '';
        this.isListening = false;
        this.recognition = null;
        this.currentModel = 'ngram';
        this.groqAvailable = false;
        this.lastWordToCorrect = '';
        
        this.setupEventListeners();
        this.initSpeechRecognition();
        this.checkGroqStatus();
    }
    
    setupEventListeners() {
        this.input.addEventListener('input', () => this.handleInput());
        this.input.addEventListener('keydown', (e) => this.handleKeyDown(e));
        this.modelToggle.addEventListener('change', () => this.toggleModel());
        
        ['languageSelect', 'autoCorrect', 'autoPredict', 'includeSentences'].forEach(id => {
            document.getElementById(id).addEventListener('change', () => this.handleControlChange(id));
        });
    }
    
    handleKeyDown(e) {
        // Auto-correct on Space key press
        if (e.key === ' ' && this.autoCorrect.checked) {
            e.preventDefault(); // Prevent default space behavior
            this.autoCorrectLastWord();
            // Add space after correction
            setTimeout(() => {
                const cursorPos = this.input.selectionStart;
                const before = this.input.value.substring(0, cursorPos);
                const after = this.input.value.substring(cursorPos);
                this.input.value = before + ' ' + after;
                this.input.selectionStart = this.input.selectionEnd = cursorPos + 1;
                this.lastInput = this.input.value;
                this.predict();
            }, 10);
        }
        
        // Clear on Escape
        if (e.key === 'Escape') {
            this.clearText();
        }
    }
    
    async autoCorrectLastWord() {
        const text = this.input.value.trim();
        if (!text) return;
        
        // Get the last word before cursor
        const cursorPos = this.input.selectionStart;
        const textBeforeCursor = text.substring(0, cursorPos);
        const words = textBeforeCursor.trim().split(/\s+/);
        const lastWord = words[words.length - 1] || '';
        
        if (lastWord.length < 2) return; // Don't correct very short words
        
        const lang = this.languageSelect.value === 'auto' ? 'en' : this.languageSelect.value;
        
        try {
            this.setStatus('Checking spelling...');
            
            // Get correction from backend
            const response = await fetch(`/correct?text=${encodeURIComponent(lastWord)}&lang=${lang}`);
            const data = await response.json();
            
            if (data.corrected && data.corrected !== data.original) {
                // Word is misspelled - show suggestions
                this.lastWordToCorrect = lastWord;
                this.showCorrectionSuggestions([data.corrected], lastWord);
            } else {
                // Word is correct - hide suggestions
                this.hideCorrectionSuggestions();
            }
            
        } catch (error) {
            console.error('Spell check failed:', error);
        }
    }
    
    showCorrectionSuggestions(suggestions, originalWord) {
        if (!suggestions.length) {
            this.hideCorrectionSuggestions();
            return;
        }
        
        let html = `<strong>Suggestions for "${originalWord}":</strong> `;
        suggestions.forEach(suggestion => {
            html += `
                <span class="correction-suggestion" 
                      onclick="predictor.applyCorrection('${originalWord}', '${suggestion}')">
                    ${suggestion}
                </span>
            `;
        });
        
        this.correctionSuggestions.innerHTML = html;
        this.correctionSuggestions.style.display = 'block';
    }
    
    hideCorrectionSuggestions() {
        this.correctionSuggestions.style.display = 'none';
        this.correctionSuggestions.innerHTML = '';
        this.lastWordToCorrect = '';
    }
    
    applyCorrection(original, corrected) {
        const cursorPos = this.input.selectionStart;
        const textBeforeCursor = this.input.value.substring(0, cursorPos);
        const textAfterCursor = this.input.value.substring(cursorPos);
        
        // Find and replace the last occurrence of the original word
        const wordsBefore = textBeforeCursor.trim().split(/\s+/);
        wordsBefore[wordsBefore.length - 1] = corrected;
        
        const newTextBefore = wordsBefore.join(' ');
        this.input.value = newTextBefore + textAfterCursor;
        
        // Show correction message
        this.showCorrectionMessage(`âœ“ Corrected: "${original}" â†’ "${corrected}"`);
        
        // Hide suggestions
        this.hideCorrectionSuggestions();
        
        // Move cursor and trigger prediction
        const newCursorPos = newTextBefore.length;
        this.input.selectionStart = this.input.selectionEnd = newCursorPos;
        this.lastInput = this.input.value;
        this.predict();
        this.input.focus();
    }
    
    toggleModel() {
        this.currentModel = this.modelToggle.checked ? 'groq' : 'ngram';
        this.updateModelUI();
        if (this.autoPredict.checked) this.predict();
    }
    
    handleControlChange(controlId) {
        if (controlId === 'includeSentences') {
            document.getElementById('sentenceSection').style.display = 
                this.includeSentences.checked ? 'block' : 'none';
        }
        if (this.autoPredict.checked) this.predict();
    }
    
    updateModelUI() {
        const isGroq = this.currentModel === 'groq';
        const color = isGroq ? '#8b5cf6' : '#10b981';
        this.modelBadge.textContent = isGroq ? 'Groq AI' : 'N-gram';
        this.modelBadge.style.background = color;
    }
    
    async checkGroqStatus() {
        try {
            const response = await fetch('/groq_status');
            const data = await response.json();
            this.groqAvailable = data.available;
            
            if (!this.groqAvailable && this.currentModel === 'groq') {
                this.modelToggle.checked = false;
                this.currentModel = 'ngram';
                this.updateModelUI();
                this.showNotification('âš ï¸ Groq API not available. Switching to N-gram mode.');
            }
        } catch (error) {
            console.error('Failed to check Groq status:', error);
        }
    }
    
    showNotification(message) {
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f59e0b;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        `;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }
    
    initSpeechRecognition() {
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            this.recognition = new SpeechRecognition();
            this.recognition.continuous = false;
            this.recognition.interimResults = false;
            this.recognition.maxAlternatives = 1;
            
            this.recognition.onstart = () => {
                this.isListening = true;
                this.showSpeechStatus('ðŸŽ¤ Listening... Speak now', 'listening');
                this.voiceBtn.textContent = 'â¹ï¸ Stop';
            };
            
            this.recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                this.insertVoiceText(transcript);
            };
            
            this.recognition.onerror = (event) => {
                if (event.error !== 'no-speech') {
                    this.showSpeechStatus(`âŒ Error: ${event.error}`, 'error');
                }
                this.stopVoiceInput();
            };
            
            this.recognition.onend = () => {
                this.stopVoiceInput();
            };
        }
    }
    
    insertVoiceText(text) {
        // Clean text - remove any automatic punctuation
        text = text.replace(/[.!?]$/, '').trim();
        
        const cursorPos = this.input.selectionStart;
        const before = this.input.value.substring(0, cursorPos);
        const after = this.input.value.substring(cursorPos);
        
        // Add space before if needed
        let insertText = text;
        if (before && !before.endsWith(' ') && before.length > 0) {
            insertText = ' ' + text;
        }
        
        this.input.value = before + insertText + after;
        const newPos = cursorPos + insertText.length;
        this.input.selectionStart = this.input.selectionEnd = newPos;
        
        this.lastInput = this.input.value;
        this.predict();
        this.input.focus();
    }
    
    toggleVoiceInput() {
        if (!this.recognition) {
            this.showSpeechStatus('âŒ Speech recognition not supported', 'error');
            return;
        }
        
        if (this.isListening) {
            this.stopVoiceInput();
        } else {
            this.startVoiceInput();
        }
    }
    
    startVoiceInput() {
        const langMap = { 'en': 'en-US', 'hi': 'hi-IN', 'fr': 'fr-FR' };
        const selectedLang = this.languageSelect.value === 'auto' ? 'en' : this.languageSelect.value;
        this.recognition.lang = langMap[selectedLang] || 'en-US';
        
        try {
            this.recognition.start();
        } catch (error) {
            this.showSpeechStatus(`âŒ Error: ${error}`, 'error');
        }
    }
    
    stopVoiceInput() {
        if (this.recognition && this.isListening) {
            this.isListening = false;
            this.recognition.stop();
        }
        this.speechStatus.style.display = 'none';
        this.voiceBtn.textContent = 'ðŸŽ¤ Voice';
    }
    
    showSpeechStatus(message, type) {
        this.speechStatus.textContent = message;
        this.speechStatus.style.display = 'block';
        this.speechStatus.style.background = type === 'error' ? '#fee2e2' : '#dcfce7';
        this.speechStatus.style.color = type === 'error' ? '#991b1b' : '#166534';
        this.speechStatus.style.borderLeft = `4px solid ${type === 'error' ? '#ef4444' : '#10b981'}`;
    }
    
    clearText() {
        this.input.value = '';
        this.clearPredictions();
        this.hideCorrectionSuggestions();
        this.input.focus();
    }
    
    showCorrectionMessage(message) {
        this.correctionMessage.textContent = message;
        this.correctionMessage.style.display = 'block';
        setTimeout(() => this.correctionMessage.style.display = 'none', 5000);
    }
    
    handleInput() {
        // Hide correction suggestions when user starts typing
        this.hideCorrectionSuggestions();
        
        if (!this.autoPredict.checked) return;
        
        clearTimeout(this.debounceTimer);
        const currentText = this.input.value;
        
        if (currentText === this.lastInput) return;
        this.lastInput = currentText;
        
        if (!currentText.trim()) {
            this.clearPredictions();
            return;
        }
        
        this.debounceTimer = setTimeout(() => this.predict(), 300);
    }
    
    async predict() {
        const text = this.input.value.trim();
        if (!text) {
            this.clearPredictions();
            return;
        }
        
        try {
            this.setStatus('Predicting...');
            
            const params = new URLSearchParams({
                text: text,
                lang: this.languageSelect.value,
                model_type: this.currentModel,
                auto_correct: this.autoCorrect.checked,
                include_sentences: this.includeSentences.checked,
                num_words: 8
            });
            
            const response = await fetch(`/predict?${params}`);
            const data = await response.json();
            
            if (data.success) {
                this.displayPredictions(data);
                this.displaySentences(data);
                this.updateStatus(data);
            } else {
                throw new Error('Prediction failed');
            }
        } catch (error) {
            console.error('Prediction error:', error);
            this.setStatus('Error getting predictions');
            this.predictionsContainer.innerHTML = `
                <div class="loading">
                    Error loading predictions. Please try again.
                </div>
            `;
        }
    }
    
    displayPredictions(data) {
        const predictions = data.predictions || [];
        const accuracy = data.accuracy_score || 0;
        const accuracyPercent = Math.round(accuracy * 100);
        
        this.accuracyScore.textContent = `${accuracyPercent}%`;
        this.accuracyScore.style.background = 
            accuracyPercent >= 80 ? '#10b981' : 
            accuracyPercent >= 60 ? '#f59e0b' : '#ef4444';
        
        if (!predictions.length) {
            this.predictionsContainer.innerHTML = `
                <div class="loading">
                    No predictions available. Try typing more text.
                </div>
            `;
            return;
        }
        
        const html = predictions
            .filter(pred => pred && pred.trim())
            .map((pred, index) => {
                const cleanPred = pred.replace(/\d+/g, '').trim();
                const confidence = Math.min(95, 85 - (index * 5));
                
                return `
                    <div class="prediction-item" onclick="predictor.insertWord('${cleanPred.replace(/'/g, "\\'")}')">
                        ${cleanPred}
                        <span class="confidence-badge">${confidence}%</span>
                    </div>
                `;
            })
            .join('');
        
        this.predictionsContainer.innerHTML = html || `
            <div class="loading">No valid predictions found.</div>
        `;
    }
    
    displaySentences(data) {
        const sentences = data.sentence_predictions || [];
        
        if (!this.includeSentences.checked || !sentences.length) {
            this.sentenceContainer.innerHTML = `
                <div class="loading">
                    No sentence predictions available.
                </div>
            `;
            return;
        }
        
        const html = sentences.map(sentence => {
            const escaped = sentence.replace(/'/g, "\\'");
            const original = data.original_text || '';
            let display = sentence;
            
            if (sentence.startsWith(original)) {
                const continuation = sentence.substring(original.length).trim();
                display = `<strong>${original}</strong> ${continuation}`;
            }
            
            return `
                <div class="sentence-item" onclick="predictor.insertSentence('${escaped}')" title="Click to use">
                    ${display}
                </div>
            `;
        }).join('');
        
        this.sentenceContainer.innerHTML = html;
    }
    
    insertWord(word) {
        const input = this.input;
        const cursorPos = input.selectionStart;
        const before = input.value.substring(0, cursorPos);
        const after = input.value.substring(cursorPos);
        
        let insert = word;
        if (before && !before.endsWith(' ')) {
            insert = ' ' + word;
        }
        
        input.value = before + insert + after;
        const newPos = cursorPos + insert.length;
        input.selectionStart = input.selectionEnd = newPos;
        
        this.lastInput = input.value;
        this.predict();
        input.focus();
    }
    
    insertSentence(sentence) {
        this.input.value = sentence;
        this.lastInput = sentence;
        this.predict();
        this.input.focus();
    }
    
    updateStatus(data) {
        this.detectedLang.textContent = (data.language || 'en').toUpperCase();
        this.responseTime.textContent = data.response_time_ms || '-';
        this.setStatus('Ready');
        
        if (data.correction_msg) {
            this.showCorrectionMessage(`Auto-corrected: ${data.correction_msg}`);
        }
    }
    
    setStatus(message) {
        this.status.textContent = message;
        this.status.style.color = message.includes('Error') ? '#dc2626' : '';
    }
    
    clearPredictions() {
        this.predictionsContainer.innerHTML = `
            <div class="loading">Start typing to see predictions...</div>
        `;
        this.sentenceContainer.innerHTML = `
            <div class="loading">Sentence predictions will appear here...</div>
        `;
        this.detectedLang.textContent = '-';
        this.responseTime.textContent = '-';
        this.accuracyScore.textContent = '--%';
        this.accuracyScore.style.background = '#10b981';
        this.setStatus('Ready');
        this.correctionMessage.style.display = 'none';
        this.hideCorrectionSuggestions();
    }
}

// Initialize
let predictor;
document.addEventListener('DOMContentLoaded', () => {
    predictor = new TextPredictor();
});
</script>
</body>
</html>
